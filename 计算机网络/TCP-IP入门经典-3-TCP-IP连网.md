### 第8章 路由选择

####TCP/IP中的路由选择

* 大多数基本形式中，路由器是负责**根据逻辑地址对通信流量进行过滤**的设备。
* 经典的网络路由器工作于**网际层**（OSI模型的网络层，第三层）。
* 路由器在传输数据时，会替换网络访问层的报头信息——因此，路由器可以连接不同类型的网络。

####  什么是路由器？

* 早期的路由器实际上就是具有两块或多块**网络适配器**的计算机。
* 至少2块网络适配器+支持IP转发的必要软件。

> 💡 IP地址是属于适配器的，而不是属于计算机的。

#### 路由选择过程

![](http://upload-images.jianshu.io/upload_images/2648731-023c4247a41dc901.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![](http://upload-images.jianshu.io/upload_images/2648731-8d36317142b54bde.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



#### 路由类型——从何处获得路由表信息？

1. **静态路由**：要求网络管理员手工输入路由信息。

   局限性：无法适应大型网络；需要耗费网络管理员大量时间；不能迅速跟随网络的变化而变化；

2. **动态路由**：根据使用路由协议获得的路由信息来建立动态路由表。



#### 路由表（“下一跳”概念）

![](http://upload-images.jianshu.io/upload_images/2648731-f6f71fd7905f1038.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

* 路由表不需要存储完整的IP地址（网络ID+主机ID），**只需要列出网络ID**即可。
* 从本质上讲，路由表就是把目的网络ID映射到下一跳的IP地址，即数据报通往目的网络的下一站。



#### IP转发

被转发的数据报里的IP地址指向最终要接收数据的主机，而转发数据报的帧中的物理地址指向路由器上本地适配器的地址。

> 解释：在网络访问层，相邻的路由器之间通过物理地址传递数据。路由器从网络适配器获取到数据后，会在网际层获取数据的IP地址，查询映射路由表，进而选择数据的下一跳地址，一个站点一个站点把数据送出去，直至到达目的IP地址对应的计算机。



#### 直接路由与间接路由。

1. 直接路由：路由器能够直接路由传递任何数据报到每个网段。



路由器了解间接路由的两种方式：

1. 系统管理员——静态路由。
2. 其他路由器——动态路由。




#### 动态路由算法

![](http://upload-images.jianshu.io/upload_images/2648731-9d863ea5eaf004b7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

##### 距离矢量路由

设计目标：让路由器之间所需的**通信最少**，让路由表中必须**保留的数据最少**。

优化路径方式：让数据报必须经过的路由器达到最少——**跳数最少**。

效率随着路由器数量的增加而降低。

距离矢量路由更新示例：

![](http://upload-images.jianshu.io/upload_images/2648731-171da7d427770e43.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



##### 链路状态路由

**路径效率≠路由器数量**

复杂情况：即使在跳数一样的情况下，经过低速链路的路由也会比经过高速链路的慢。

设计理念：每个路由器都尝试建立关于网络拓扑（各路由器状态信息）的内部映射。



**自治系统**：参与到更大网络的网络，由自制实体进行维护。

**外部路由器**：外部路由器在自治网络之间交换路由信息，它们维护自己及邻居自治网络的路由信息。

* 边界路由协议（BGP），也可以作为自治系统内部协议；

**内部路由器**：自治网络内部共享路由信息的路由器。

![](http://upload-images.jianshu.io/upload_images/2648731-0c7dc6da82d5bc08.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



**核心路由器**：支持自治系统构建的骨干网络。





#### 路由信息协议（RIP）

* 距离矢量协议。
* 主动RIP节点／被动RIP节点；
* 网络平衡时，工作效果最好；
* 最大跳数为15；
* RIP Ⅱ 更新支持 CIDR



#### 开放最短路径优先（OSPF）

* 链路状态协议；
* 路由器ID；
* 支持无类别寻址（CIDR）；



> 很多复杂的现代化路由器并不局限于IP转发，而且还可以根据高层协议实现其他很多服务。



### 第9章 连网

#### 拨号连接

调制解调器（modem）通过电话线提供网络访问。

**调制解调器的作用**：把来自于计算机的数字信号传输转化为能够通过电话系统的端口进行传输的模拟信号，同时也把来自电话线的模拟信号转化为计算机能够理解的数字信号。

> 数字信号 ⇄ 模拟信号

##### 点到点连接

![](http://upload-images.jianshu.io/upload_images/2648731-c5fc421c8ba77ddf.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



局限性：电话连接的传输速率比局域网低。

##### 调制解调器协议

* 串行线路网际协议（SLIP）；
* 点到点协议（PPP）；



#### 电缆宽带

* 电缆调制解调器直接连接到一条同轴电缆，后者被连接到有线电视服务网络上。
* 电缆调制解调器终端系统（CMTS）；



#### 数字用户线路 （DSL）

* 双绞线电话网。
* 数字服务线路访问多路复用器（DSLAM）。



#### 广域网（WAN）

在远距离提供高速率带宽连网。

广域网新式：

* 帧中继；
* 综合业务数字网（ISDN）；
* 高级数据链路控制（HDLC）；
* 异步传输模式（ATM）；



#### 无线网络连接

* 802.11网络；
* 移动IP；
* 蓝牙；



#### 连接设备

* 网桥：根据物理地址过滤和转发数据包的连接设备，它工作于OSI模型的数据链路层。
* HUB：用于连接网络电缆而构成一个网段的设备。
* 交换机：连接设备，能把接受到的数据转发到相应的端口。




### 第10章 名称解析





#### 什么是名称解析？

计算机主机名称 —> IP地址



早期的名称解析系统：**主机名称系统**。

* 主机文件（hosts、hosts.txt）：是一个保存有主机名、相关IP地址列表的文件。
* 简单高效，适用于小型网络，大型网络下效率较低；
* 扁平化的主机名称空间，无法利用IP地址空间高效的层次结构；

![](http://upload-images.jianshu.io/upload_images/2648731-23983490dac45b09.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)





升级：**域名系统（DNS）**。

* DNS服务器：专用的名称解析服务器；

* 将本地名称解析的权利授予本地管理员；

  

![](http://upload-images.jianshu.io/upload_images/2648731-d2d673965d4bd82d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



* 如果名称服务器在自己保存的地址数据库中发现了被请求的地址，则将这个地址发回给客户端。
* 如果名称服务器在自己保存的地址数据库中没有找到这个地址，会要求其他的名称服务器查找这个地址，接着将这个地址发回给客户端。
* 使用完全限定域名（FQDN）：主机名+特定的域名。

![](http://upload-images.jianshu.io/upload_images/2648731-60cddde3c0c7f67a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



* 客户端向服务器发送递归查询，名称服务器向其他服务器发送一系列迭代查询

![](http://upload-images.jianshu.io/upload_images/2648731-4ba0b322f09471fc.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



#### 名称服务器类型

* 首选名称服务器：负责维护域的信息。
* 备份或者备用域名服务器；
* 只缓存服务器：



#### 域和区域

* 区域：在一组公共DNS服务器上配置的DNS主机的集合。
* 域是名称空间的一部分；
* 如果子域没有被专门委派，就不需要单独的区域，只用将它包含在父域的区域文件中。
* 逆向查找区域文件：IP地址—> 主机名。



#### DNS的安全扩展（DNSSEC）

* 验证返回DNS数据的有效性；



#### DNS工具

* web浏览器、FTP客户端、Telent客户端、ping工具。
* NSLookup
* 域名信息搜索（DIG）



### 第11章 TCP/IP安全

#### 什么是防火墙

* 防火墙是一个放置在网络路径上的设备，它可以检查、接受或者拒绝打算进入网络的数据包；
* 与传统路由器的区别？传统路由器会**尽可能转发数据包**，而防火墙**只转发自己认可的数据包**；
* 防火墙可以阻止任何或者所有的外界流量进入网络，但是它并步干涉内部网络中的通信：

![](http://upload-images.jianshu.io/upload_images/2648731-0b5a11205f1c6af8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

* 最早的防火墙是**数据包过滤**。它通过检查数据包（目的端口号）来找出该数据包的企图。
* 打入内部网络的入侵者可以偷偷地将网络服务所使用的端口号进行重新配置，而入侵者秘密建立一个使用不同端口号的Telnet服务。
* **有状态防火墙**：检查数据包+数据包所在的通信会话序列；
* **应用层防火墙**



#### 选择防火墙

* 个人桌面防火墙；
* 防火墙／路由器设备；
* 使用一台计算机作为网络防火墙；
* 商业防火墙设备；



#### DMZ

简单的策略：将需要被Internet访问的服务器放在防火墙之外：

* 本地资源放在防火墙之后。
* 通过Internet访问的资源放在防火墙之前。

![](http://upload-images.jianshu.io/upload_images/2648731-4167f28794ab45d7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



两个防火墙：一个防火墙位于Internet服务器之前，另一个位于它们之后。

* 前端防火墙／后端防火墙。
* 两个防火墙之间的空间被称为 DMZ（军事术语）。

![](http://upload-images.jianshu.io/upload_images/2648731-2fdb342b692f73ab.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



#### 防火墙规则

防火墙规则：一系列配置防火墙行为的命令或规则。

内容：

* 资源地址或地址范围；
* 目的地址范围；
* 服务；
* 行为；



#### 代理服务／逆向代理

代理服务器可以截获对internet资源的请求，并替代客户端转发这些请求，它在客户端和服务器之间扮演了一个中介的角色。

* 代理服务器：代理向外发送到internet上的请求。
* 逆向代理：接受来自外部资源的请求。

![](http://upload-images.jianshu.io/upload_images/2648731-1c48ecfb97a1d9c8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)





#### 攻击技术

##### 计算机攻击者

* 青少年业务爱好者；
* 消遣性入侵者；
* 专业人士；

##### 入侵者想要什么

1. 取得系统访问权；
2. 取得权限；
3. 四处闲逛；
4. 准备好下一轮攻击；

##### 攻击类别

* 证书攻击；
  * 看看机箱外面；
  * 特洛伊木马；
  * 猜测；
  * 窃听：包嗅探器、网络流量监听工具（捕获明文）
* 网络层攻击；
  * 会话劫持（窃听TCP会话，在数据流中插入数据包）
* 应用层攻击；
  * 缓冲区溢出；
* 网络钓鱼:欺骗性链接、E-mail信息或网页
  * 跨站脚本攻击；

（权限提升：先获得低级别访问权——> 再获得更高的权限级别——>打开隐藏的后门）

* 网络安全扫描仪（Nmap、Nessus）：查找开放的端口或其他潜在的攻击矢量；


##### 拒绝服务攻击（Dos攻击）：用大量请求阻塞系统，使系统资源全部耗尽，性能降低。

* 分布式Dos攻击

![](http://upload-images.jianshu.io/upload_images/2648731-b7cc7a0f7e317050.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)





#### 防范措施

* 加密和保密
* 算法和密钥



**对称加密**：加密和解密过程使用的是相同的密钥；

* DES；
* AES加密；



**非对称加密**：用来加密数据的密钥，与用来解密数据的密钥不同。

**数字签名**：确保消息的真实性，用于确保数据来自其所属的数据源，并且没有被篡改过。

**数字证书**：公开密钥的加密副本（被加密的公钥）。证书服务器：CA：

数字证书的作用：确保谁可以获得公钥的访问权。

![](http://upload-images.jianshu.io/upload_images/2648731-ba08f89ac888c450.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



#### SSL和TLS

SSL和TLS用于面向连接的TCP连接。

DTLS：支持UDP连接。

SSL的目的：在传输层上的套接字和提供那些套接字访问网络的应用程序之间提供一层安全。

SSL协议在TCP中的位置：

![](http://upload-images.jianshu.io/upload_images/2648731-5ff4b78288b1d4c8.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

SSL协议：

![](http://upload-images.jianshu.io/upload_images/2648731-7412670cc519603f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

#### IPSec



#### 虚拟专用网络VPN

VPN：建立一个横穿网络的点对点“隧道”。

![](http://upload-images.jianshu.io/upload_images/2648731-89e905c245a8df56.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

Kerberos：一种基于网络的身份验证和访问控制系统。




### 第12章 配置

* 动态地址分配
* DHCP
* NAT
* 零配置




### 第13章 IPv6：下一代协议

#### 新IP系统的必要性

* IP地址即将用完。
* IPv4有32位地址字段，可以提供30亿个主机ID。
* 一个网络ID通常会被分配给一个组织，并且由这个组织控制主机ID在自己网络上的分配。

![](http://upload-images.jianshu.io/upload_images/2648731-f8dc990eabd4f492.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

* 网络地址转换（NAT）的应用降低了对Internet地址对需求，无类域间路由（CIDR）地址系统找回了许多未被使用的地址。
* IPv6中的IP地址是128位的地址，它支持10亿个网络。



IPv6的目标：

* 扩展寻址的能力：
* 更简单的报头格式；
* 提升了对扩展和选项的支持；
* 流标签；
* 提升身份认证和隐私保护的能力；



IPv6报头相比于IPv4更简单，部分原因是：其他的细节信息被放在了主报头之后的扩展报头中。



IPv6地址范围：

![](http://upload-images.jianshu.io/upload_images/2648731-68929e5d43cd62ce.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

IPv6地址通常是由用冒号隔开8个4位十六进制数组成的（显示时每一组数据都会省略掉前面的0）；

2001:DB8:0:0:8:800:200C:417A

还可以通过双冒号替代多个连续的0以简化写法：

2001:DB8::8:800:200C:417A



#### 多播

在多播中，主机参与到共享同一个多播地址的多播组中，不是该成员的主机不能读取消息，这就使得多播的效率高于广播。

#### 链路本地

前缀为fe80::/10的IPv6地址是链路本地地址。

#### 邻居发现

在IPv6中，IP地址到物理地址到映射是通过邻居发现的过程实现的。

#### 自动配置

IPv6自动配置基于物理地址的一个哈希为计算机指派一个链路本地地址。

#### IPv6和服务质量

考虑到了数据传递优先级。

#### IPv6和IPv4

* 多协议配置；（IPv4映射成IPv6）
* IPv6隧道代理：实现远程IPv6连接。
* 6to4映射技术：（IPv4自动映射成IPv6地址的一种方法）
* Teredo：6to4的替代技术，解决NAT问题
